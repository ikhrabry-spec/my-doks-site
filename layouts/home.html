{{/* Превентивное переопределение всех блоков */}}
{{ define "main" }}{{ end }}
{{ define "sidebar-prefooter" }}{{ end }}
{{ define "sidebar-footer" }}{{ end }}

{{ define "main" }}
<!-- ======================================== -->
<!-- БЛОК ДИАГНОСТИКИ (начните с этого)       -->
<!-- ======================================== -->
<div id="diagnostic-block" style="
  position: fixed;
  top: 10px;
  left: 10px;
  background: white;
  padding: 15px;
  z-index: 10000;
  border: 2px solid blue;
  max-width: 600px;
  box-shadow: 0 0 10px rgba(0,0,0,0.3);
  font-family: monospace;
">
  <h3 style="margin-top: 0; color: navy; border-bottom: 1px solid #ccc; padding-bottom: 5px;">
    ДИАГНОСТИКА ГЛАВНОЙ СТРАНИЦЫ
  </h3>

  <!-- Основные параметры -->
  <div style="margin-bottom: 10px;">
    <p><strong>›› Шаблон:</strong> home.html (layouts)</p>
    <p><strong>›› Заголовок:</strong> {{ .Title }}</p>
    <p><strong>›› Путь фона:</strong> {{ with .Params.background }}{{ .image }}{{ else }}не указан{{ end }}</p>
    <p><strong>›› Путь лого:</strong> {{ .Params.logo | default "не указан" }}</p>
    <p><strong>›› Время:</strong> {{ now.Format "15:04:05" }}</p>
  </div>

  <!-- Проверка ресурсов -->
  <div style="background: #f0f8ff; padding: 10px; border-radius: 4px; margin-bottom: 10px;">
    <h4 style="margin: 5px 0; color: #1e5b8e;">ПРОВЕРКА РЕСУРСОВ</h4>

    {{ $bg := "" }}
    {{ if and .Params.background .Params.background.image }}
      {{ $bg = resources.Get .Params.background.image }}
    {{ end }}
    <p><strong>› Фон:</strong>
      {{ if $bg }}
        <span style="color:green; font-weight: bold;">НАЙДЕН</span>
        ({{ $bg.Width }}×{{ $bg.Height }}px)
      {{ else }}
        <span style="color:red; font-weight: bold;">НЕ НАЙДЕН!</span>
      {{ end }}
    </p>

    {{ $logo := "" }}
    {{ if .Params.logo }}
      {{ $logo = resources.Get .Params.logo }}
    {{ end }}
    <p><strong>› Логотип:</strong>
      {{ if $logo }}
        <span style="color:green; font-weight: bold;">НАЙДЕН</span>
        ({{ $logo.MediaType }})
      {{ else }}
        <span style="color:red; font-weight: bold;">НЕ НАЙДЕН!</span>
      {{ end }}
    </p>
  </div>

  <!-- Контрольные точки -->
  <div style="background: #fff0f0; padding: 10px; border-radius: 4px;">
    <h4 style="margin: 5px 0; color: #8e1e1e;">КОНТРОЛЬНЫЕ ТОЧКИ</h4>
    <p><strong>›› Z-index фона:</strong> <span id="z-index-status">проверка...</span></p>
    <p><strong>›› Загрузка Bootstrap Icons:</strong> <span id="icons-status">проверка...</span></p>
    <p><strong>›› Видимость контента:</strong> <span id="content-visibility">проверка...</span></p>
  </div>
</div>

<!-- ======================================== -->
<!-- ОСНОВНОЙ КОНТЕНТ (упрощенная версия)     -->
<!-- ======================================== -->
<div class="homepage" style="position: relative;">

  <!-- Фон с диагностикой -->
  <div id="homepage-bg" style="
    {{ with $bg }}background-image: url('{{ .RelPermalink }}');{{ end }}
    background-size: cover;
    background-position: center;
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    z-index: -10; /* Возможная проблема! */
    {{ if not $bg }}background-color: #e0e0e0;{{ end }}
    border: 2px solid {{ if $bg }}green{{ else }}red{{ end }};
  ">
    <!-- Индикатор фона -->
    <div style="
      position: absolute;
      bottom: 10px;
      right: 10px;
      background: rgba(0,0,0,0.7);
      color: white;
      padding: 5px 10px;
      font-size: 12px;
    ">
      {{ if $bg }}
        Фон загружен: {{ .Params.background.image }}
      {{ else }}
        ФОН НЕ ЗАГРУЖЕН!
      {{ end }}
    </div>
  </div>

  <!-- Упрощенный контент -->
  <div class="content-wrapper" style="
    position: relative;
    z-index: 10;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
  ">
    <!-- Тестовый заголовок -->
    <header style="
      background: rgba(30, 30, 100, 0.9);
      padding: 20px;
      text-align: center;
    ">
      <h1 style="color: white; margin: 0;">
        {{ .Title }}
        <span style="font-size: 0.6em; display: block; color: #a0a0ff;">
          (работает шаблон home.html)
        </span>
      </h1>
    </header>

    <!-- Блок с предупреждением -->
    <div style="
      background: #ffeb3b;
      color: #333;
      padding: 15px;
      text-align: center;
      border-bottom: 2px solid #ff9800;
    ">
      <p style="margin: 0; font-weight: bold;">
        ⚠️ Это упрощенная версия! Полный функционал появится после диагностики
      </p>
    </div>

    <!-- Простой контент -->
    <main style="
      flex-grow: 1;
      padding: 30px 20px;
      max-width: 1200px;
      margin: 0 auto;
      width: 100%;
      background: rgba(255, 255, 255, 0.95);
    ">
      <h2>Что проверяем:</h2>
      <ol>
        <li>Загрузку фонового изображения (см. диагностический блок)</li>
        <li>Работоспособность z-index (фон должен быть ПОД контентом)</li>
        <li>Отсутствие конфликтов CSS (проверьте через DevTools)</li>
      </ol>

      <div style="
        background: #4caf50;
        color: white;
        padding: 20px;
        margin-top: 20px;
        border-radius: 8px;
        text-align: center;
      ">
        <h3>Если вы видите этот текст:</h3>
        <p>Шаблон home.html работает корректно!</p>
        <p>Постепенно возвращайте компоненты из оригинальной версии.</p>
      </div>
    </main>

    <!-- Простой футер -->
    <footer style="
      background: #333;
      color: white;
      padding: 15px;
      text-align: center;
    ">
      <p style="margin: 0;">
        © {{ now.Year }} {{ site.Params.author | default "Balloting.Net" }}
      </p>
    </footer>
  </div>
</div>

<!-- ======================================== -->
<!-- СКРИПТЫ ДИАГНОСТИКИ                     -->
<!-- ======================================== -->
<script>
  // Проверка z-index фона
  const bgElement = document.getElementById('homepage-bg');
  if (bgElement) {
    const zIndex = parseInt(window.getComputedStyle(bgElement).zIndex);
    document.getElementById('z-index-status').innerHTML =
      (zIndex < 0) ? `✅ ${zIndex} (фон ПОД контентом)` : `⚠️ ${zIndex} (возможны проблемы)`;
  }

  // Проверка загрузки Bootstrap Icons
  const iconsCheck = document.createElement('div');
  iconsCheck.className = 'bi bi-check-circle-fill';
  iconsCheck.style.position = 'absolute';
  iconsCheck.style.left = '-9999px';
  document.body.appendChild(iconsCheck);

  setTimeout(() => {
    const isLoaded = window.getComputedStyle(iconsCheck).display !== 'none';
    document.getElementById('icons-status').innerHTML =
      isLoaded ? '✅ Загружены' : '❌ Не загружены!';
    document.body.removeChild(iconsCheck);
  }, 500);

  // Проверка видимости контента
  const contentCheck = () => {
    const content = document.querySelector('main');
    const isVisible = content ? content.offsetWidth > 0 && content.offsetHeight > 0 : false;
    document.getElementById('content-visibility').innerHTML =
      isVisible ? '✅ Видимый' : '❌ Не видим! Проверьте CSS';
  };
  setTimeout(contentCheck, 1000);

  // Логирование в консоль
  console.groupCollapsed('[Диагностика главной страницы]');
  console.log('Title:', "{{ .Title }}");
  console.log('Background:', "{{ with .Params.background }}{{ .image }}{{ end }}");
  console.log('Layout:', "home.html");
  console.log('Timestamp:', new Date().toISOString());
  console.groupEnd();
</script>

<!-- Подключаем Bootstrap Icons (возможная проблема!) -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css"
      onerror="console.error('Ошибка загрузки Bootstrap Icons')">

{{ end }}
