<div class="patents-container">
    <div class="patents-header"></div>
    <ul class="patents-list" id="patents-list">
        {{ $isPatentsPage := and (eq .context.Kind "page") (eq .context.File.BaseFileName "Patents") }}
        {{ $currentPageSlug := .context.File.BaseFileName }}
        {{ $showNumbers := .displayNumbers }}
        {{ $counter := 0 }}

        {{ $patentsToDisplay := .context.Site.Data.Patents }}

        {{ if not $isPatentsPage }}
            {{ $patentsToDisplay = slice }}
            {{ range .context.Site.Data.Patents }}
                {{ if in .referenced_in $currentPageSlug }}
                    {{ $patentsToDisplay = $patentsToDisplay | append . }}
                {{ end }}
            {{ end }}
        {{ end }}

        {{ range $patentsToDisplay }}
            {{ $counter = add $counter 1 }}

            {{/* –ì–ï–ù–ï–†–ê–¶–ò–Ø cardId */}}
            {{ $cardId := "" }}
            {{ with .anchor }}
                {{ $cardId = trim . " " }}
            {{ end }}
            {{ if eq $cardId "" }}
                {{ with .name }}
                    {{ $cardId = . | urlize }}
                {{ else }}
                    {{ $cardId = printf "patent-%d" $counter }}
                {{ end }}
            {{ end }}

            <li class="patent-item"
                id="card-{{ $cardId }}"
                data-card-id="{{ $cardId }}"
                data-patent-number="{{ $counter }}"
                data-patent-name="{{ .name | default .title }}">

                <!-- –ö–û–†–û–¢–ö–ò–ô –í–ò–î -->
                <span class="patent-item-short">
                    {{ if $showNumbers }}
                        <span class="patent-number">{{ $counter }}.</span>
                        <span class="patent-name">{{ .name | default .title }}</span>
                    {{ end }}
                </span>

                <!-- –ü–û–õ–ù–´–ô –í–ò–î -->
                <span class="patent-item-full" style="display: none;">
                    <span class="patent-item-header">
                        <span class="patent-number">{{ $counter }}.</span>
                        <span class="patent-name">{{ .name | default .title }}</span>
                    </span>
                    <div class="patent-details">
                        <p>
                            <!--{{ with .number }}<strong>–ù–æ–º–µ—Ä –ø–∞—Ç–µ–Ω—Ç–∞:</strong> {{ . }}<br>{{ end }}-->
                            {{ with .inventor }}<strong>–ò–∑–æ–±—Ä–µ—Ç–∞—Ç–µ–ª—å:</strong> {{ . }}<br>{{ end }}
                            {{ with .year }}<strong>–ì–æ–¥:</strong> {{ . }}<br>{{ end }}
                            {{ with .country }}<strong>–°—Ç—Ä–∞–Ω–∞:</strong> {{ . }}<br>{{ end }}
                            {{ .description }}
                            <br>
                            {{ if .url }}
                                <a href="{{ .url }}" target="_blank">{{ .url }}</a>
                            {{ end }}
                        </p>

                        <!-- –°–°–´–õ–ö–ê -->
                        {{ $collectionBaseUrl := "/docs/reference-books/patents/" }}
                        <div class="patent-item-more-details">
                            <a href="{{ $collectionBaseUrl }}#card-{{ $cardId }}"
                               class="more-details-button"
                               onclick="return saveScrollPositionForPatents(event)">
                                More detailed
                            </a>
                        </div>
                    </div>
                </span>
            </li>
        {{ end }}
    </ul>
</div>

<script>
// –§–£–ù–ö–¶–ò–Ø –°–û–•–†–ê–ù–ï–ù–ò–Ø –î–õ–Ø PATENTS
function saveScrollPositionForPatents(event) {
    console.log('üìç [PATENTS] –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞...');

    // –ù–∞—Ö–æ–¥–∏–º –∫–∞—Ä—Ç–æ—á–∫—É
    const link = event.currentTarget;
    const card = link.closest('.patent-item');

    if (!card) {
        console.error('‚ùå –ö–∞—Ä—Ç–æ—á–∫–∞ –ø–∞—Ç–µ–Ω—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
        return true;
    }

    // –ü–æ–ª—É—á–∞–µ–º –Ω–æ–º–µ—Ä –º–∞—Ä–∫–µ—Ä–∞
    const patentNumber = card.getAttribute('data-patent-number');

    // –û—á–∏—â–∞–µ–º –í–°–Å –¥–ª—è —á–∏—Å—Ç–æ—Ç—ã
    sessionStorage.clear();

    // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–∏–ø –ò –Ω–æ–º–µ—Ä
    sessionStorage.setItem('markerType', 'patent');  // –ö–õ–Æ–ß–ï–í–û–ï!
    sessionStorage.setItem('markerNumber', patentNumber);
    sessionStorage.setItem('scrollTop', window.pageYOffset);
    sessionStorage.setItem('timestamp', Date.now());

    console.log('üíæ [PATENTS] –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ —Ç–∏–ø: patent, –Ω–æ–º–µ—Ä:', patentNumber);

    return true; // –†–∞–∑—Ä–µ—à–∞–µ–º –ø–µ—Ä–µ—Ö–æ–¥
}
</script>
